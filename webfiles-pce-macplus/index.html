<!--
RetroWeb Browser (pce/mac-plus)
Copyright (C) 2014 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="mac-plus-ui.css">
		<script type="text/javascript" src="navigator.js"></script>
		<title>RetroWeb Browser (pce/macplus)</title>
	</head>
	<body>
		<script type="text/javascript" src="utils.js"></script>
		
		<div id="mac">

				<canvas class="emscripten" id="mac-screen" oncontextmenu="event.preventDefault()">
				</canvas>
				
				<div id="popups">
					<div id="popup-rom-missing" class="popup">
						<img src="icons/rom.png" class="small-icon">
						<p>This computer cannot start without a valid ROM file.</p>
						<input type="button" value="Select ROM file..."
							onclick="openFileUploader ('Select ROM image', doRomUpload);">
					</div>
					<div id="popup-ready-to-use" class="popup" onclick="popups.close('popup-ready-to-use');">
						<img src="icons/sunny.png" class="small-icon">
						<h1>This computer is ready to use!<br>Double-click here to begin.</h1>
					</div>
					<div id="popup-status" class="popup">
						<div class="spinner"></div>
						<div class="emscripten" id="status">Downloading...</div>
						<div class="emscripten">
							<progress value="0" max="100" id="progress" hidden=0></progress>  
						</div>
					</div>
					<div id="popup-uploader" class="popup">
						<h1 id="uploader-text">Select a file:</h1>
						<form name="file-upload" onsubmit="return false">
							<p>
							<input type="file" id="uploaderfile" chars="80"><br>
							</p>
							<input type="submit" value="OK" id="uploader-ok-btn">
							<input type="button" value="Cancel" onclick="popups.close('popup-uploader');">
						</form>
					</div>
					<script type="text/javascript">
						var popups = new PopupManager();
						popups.add("popup-rom-missing");
						popups.add("popup-ready-to-use");
						popups.add("popup-status");
						popups.add("popup-uploader");
					</script>
				</div>
				
				<div id="sidepanel">
						<h2>Double-click an icon to open it:</h2>
						<p>
						<div id="navigator">
						</div>
						<div id="html-viewer-button">
							<input type="button" value="Close" onClick="htmlViewerCloseAction();">
						</div>
						<div id="html-viewer">
							<iframe id="html-iframe" frameborder="0" seamless="seamless" scrolling="auto" src="docs/about.html">
							</iframe>
							<div id="html-text-viewer"></div>
							<!--<div class="fade-effect-top"></div>-->
							<div class="fade-effect-bottom"></div>
						</div>
				</div>
		</div>
		
		
		<textarea class="emscripten" id="output" rows="8" hidden=1></textarea>

		<script type="text/javascript">
			fetchNavigatorUrl();
		</script>
		
		<script type='text/javascript'>
			var statusElement = document.getElementById('status');
			var progressElement = document.getElementById('progress');
			var macStatus = document.getElementById('popup-status');

			var Module = {
				preRun: [macPreRun],
				postRun: [],
				preInit: [macPreInit],
				noInitialRun: false,
				print: function(text) {
					text = Array.prototype.slice.call(arguments).join(' ');
					console.log(text);
				},
				printErr: function(text) {
					text = Array.prototype.slice.call(arguments).join(' ');
					console.log(text);
				},
				canvas: document.getElementById('mac-screen'),
				setStatus: function(text) {
					  if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
					  if (text === Module.setStatus.text) return;
					  var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
					  var now = Date.now();
					  if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon
					  if (m) {
						text = m[1];
						//progressElement.value = parseInt(m[2])*100;
						//progressElement.max = parseInt(m[4])*100;
						//progressElement.hidden = false;
						popups.open("popup-status");
					  } else {
						//progressElement.value = null;
						//progressElement.max = null;
						//progressElement.hidden = true;
						if (!text) popups.close("popup-status");
					  }
					  statusElement.innerHTML = text;
					},
				totalDependencies: 0,
				monitorRunDependencies: function(left) {
					this.totalDependencies = Math.max(this.totalDependencies, left);
					Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
				}
			};
			Module.setStatus('Downloading...');
		</script>
		
		<script async type="text/javascript" src="macplus.js"></script>
		
		<!-- Google Analytics -->
		
		<!--<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-47856782-1', 'freeshell.org');
		  ga('send', 'pageview');
		</script>-->
		
	</body>
</html>