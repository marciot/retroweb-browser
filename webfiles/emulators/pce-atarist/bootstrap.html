<!--
RetroWeb Browser
Copyright (C) 2014 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->

<style>
	.background {
		width:    1543px;
		height:   1049px;
		background:url(/emulators/skins/atari1040st.jpg);
		background-repeat:no-repeat;
		background-size:100%;
		margin-right: -500px;
	}

	.screen {
		left:      445px;
		top:       175px;
		width:     440px;
		height:    320px;
	}

	.sidepanel {
		margin:       0;
		margin-right: 730px;
	}
</style>

<script type="text/javascript">
	processEmulatorConfig(
		{
			"name" : "Atari 1040ST",
			"pre" : [], 
			"run" : ["/emulators/pce-atarist/pce-atarist.js"],
			"mkdir" : [ "/roms" ],
			"preload-files" : [
				"/emulators/pce-atarist/pce-config.cfg -> /roms/pce-config.cfg",
				"/roms/tos-1.04-us.rom"
			]
		}
	);
	
	/* Interface to RetroWeb Browser */

	new class extends EmulatorInterface {
		constructor() {
			super();
			this.setArgument("-c", "pce-config.cfg");
			this.setArgument("-r", "");
		}

		getDrives() {
			return {
				"hd1" : "hd1.img",
				"fd1" : "fd1.st"
			}
		}

		preRun() {
			popups.open("popup-mouse-center");
		}

		mountDisk(diskFile) {
			console.log("Mounting " + diskFile);
			var driveId = diskFile.match(/fd(\d)+/)[1];
			stSetMessage ("emu.disk.insert", (driveId - 1) + ":" + diskFile);
		}

		reset() {
			stSetMessage ("emu.reset", "");
		}
	}

	/* Helper functions */

	function stSetMessage(msg,val) {
		var sim = _st_get_sim();
		var _stSetMessage = Module.cwrap('st_set_msg', 'int', ['int','string', 'string']);
		_stSetMessage(sim, msg, val);
	}
</script>