<!--
RetroWeb Browser
Copyright (C) 2014 Marcio Teixeira

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
-->

<template id="retrowebTemplate">
	<style>
		/* Interface buttons */

		.ui-buttons {
			position: relative;
			z-index:  10;
		}

		.ui-btn {
			font-size: small;
			font-family: "Arial Black", "Arial Bold", Gadget, sans-serif;

			width: 50px;
			text-align: center;
		}

		.btn-icon {
			width: 32px;
			height: 32px;
		}

		.btn-label {
			visibility : hidden;
		}

		.btn-icon:hover~.btn-label {
			visibility : visible;
		}

		#sidebar {
			padding-top:		30px;
			padding-left:		10px;
			padding-right:		10px;
			width:				100%;
			height:				100%;
		}
	</style>
	
	<emulator-skin id="skin" flush="right">
		<div id="screen-area"></div>
		<div id="sidebar">
			<table id="ui-buttons" class="ui-buttons">
				<tr>
					<td class="ui-btn">
						<img class="btn-icon" src="/ui-artwork/document.png" onclick="navShow();"><br>
						<span class="btn-label">Show Navigator</span>
					</td>
				</tr>
			</table>
			<!-- The navigator gets inserted here -->
		</div>
	</emulator-skin>
</template>

<script src="http://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="/lib/utils.js"></script>

<script>
	// Global variables for RetroWeb

	var emulator = null;

	(function(namespace){
		// The following is requires for the webcomponents polyfill
		document._currentScript = document._currentScript || document.currentScript;

		// importDoc references this import's document
		var importDoc = document._currentScript.ownerDocument;

		/* There is no longer a way to show the developer console on iOS devices, so make
		 * it so errors become alerts.
		 *
		 * Detection code from:
		 *   http://stackoverflow.com/questions/9038625/detect-if-device-is-ios
		 */
		namespace.isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
		namespace.addIOSErrorHandler = function (where) {
			if(namespace.isIOS) {
				where.onerror = function(error) {
					alert(error);
				};
			}
		}

		function setBackground(emulator) {
			var skins = {
				"pce-macplus"	: "macplus",
				"pce-ibmpc"		: "ibm5160",
				"pce-ibmpc-xt"	: "ibm5160",
				"pce-atarist"	: "atari1040st",
				"pce-rc759"		: "rc759",
				"sae-amiga"		: "amiga500",
				"mame-c64"		: "commodore64c",
				"mame-trs80"	: "trs80-model1",
				"mame-apple2e"	: "apple2e",
				"xerox-star"	: "xerox-star"
			};
			if(emulator == "xerox-star") {
				$("#screen-area").hide();
			}
			var skin = document.getElementById("skin").loadByName(skins[emulator]);
		}

		function webComponentsReady() {
			// Stamp the HTML inside the body of the main page
			var template = importDoc.getElementById('retrowebTemplate');
			var clone = document.importNode(template.content, true);
			var host = document.getElementsByTagName("body")[0];
			host.appendChild(clone);

			createNavigator(document.getElementById("sidebar"));
			populateEmulatorList();

			var whichEmulator = RetroWeb.query.emulator || chooseEmulator();

			// jsmess has been renamed to mame
			whichEmulator = whichEmulator.replace("jsmess", "mame");

			setBackground(whichEmulator);

			emulator = createEmulator(
				document.getElementById("screen-area"),
				whichEmulator
			);

			emulator.onEmulatorConfigured = function() {
				navInitialDoc();
			}
		}

		window.addEventListener('WebComponentsReady', webComponentsReady);

		namespace.addIOSErrorHandler(window);
	})(window.RetroWeb = window.RetroWeb || {});
</script>

<!-- The following will enable Google Analytics if the .include file exists -->
<!--#include virtual="../private/googleAnalytics.include"-->
<!-- End of Google Analytics -->

<script type="text/javascript">
	if (typeof ga == 'function') {
		gaTrackEvent = function (category, action, label, value) {
			console.log("Logging event: " + category);
			ga('send', 'event', category, action, label, value);
		};
	} else {
		gaTrackEvent = function (category, action, label, value) {};
	}
</script>
